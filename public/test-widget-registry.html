<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Registry Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .summary { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Widget Registry Test</h1>
    <div id="test-results"></div>
    <div id="summary" class="summary"></div>

    <script type="module">
        const resultsContainer = document.getElementById('test-results');
        const summaryContainer = document.getElementById('summary');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsContainer.appendChild(div);
        }

        async function testWidgetRegistry() {
            try {
                addResult('üß™ Starting Widget Registry Test...', 'info');

                // Import the registry initializer
                const { initializeRegistries } = await import('./src/components/library/core/RegistryInitializer.js');

                // Initialize registries
                addResult('üîß Initializing registries...', 'info');
                initializeRegistries();

                // Import widget registry
                const { WidgetRegistry } = await import('./src/components/library/core/WidgetRegistry.js');

                // Test registered widgets
                const testWidgets = [
                    'autocomplete',
                    'input-field',
                    'combo-box',
                    'input-number',
                    'textarea',
                    'radio',
                    'checkbox',
                    'date-picker',
                    'segmented',
                    'slider',
                    'switch',
                    'rate',
                    'select',
                    'multiselect',
                    'dynamic-observations'
                ];

                addResult('üìã Testing widget registrations...', 'info');

                let registeredCount = 0;
                const results = [];

                for (const widgetType of testWidgets) {
                    const isRegistered = WidgetRegistry.has(widgetType);
                    const component = WidgetRegistry.get(widgetType);

                    results.push({
                        type: widgetType,
                        registered: isRegistered,
                        hasComponent: !!component
                    });

                    if (isRegistered) {
                        addResult(`‚úÖ ${widgetType}: REGISTERED`, 'success');
                        registeredCount++;
                    } else {
                        addResult(`‚ùå ${widgetType}: NOT FOUND`, 'error');
                    }
                }

                // Summary
                const totalCount = testWidgets.length;
                const success = registeredCount === totalCount;

                summaryContainer.innerHTML = `
                    <h3>üìä Test Summary</h3>
                    <p><strong>Widgets Registered:</strong> ${registeredCount}/${totalCount}</p>
                    <p><strong>Status:</strong> ${success ? 'üéâ ALL TESTS PASSED' : '‚ö†Ô∏è SOME TESTS FAILED'}</p>
                    <p><strong>All Registered Types:</strong> ${WidgetRegistry.list().join(', ')}</p>
                `;

                if (success) {
                    summaryContainer.classList.add('success');
                } else {
                    summaryContainer.classList.add('warning');
                }

                addResult(`üèÅ Test Complete: ${registeredCount}/${totalCount} widgets registered`, success ? 'success' : 'warning');

            } catch (error) {
                addResult(`‚ùå Test failed: ${error.message}`, 'error');
                console.error('Test error:', error);
            }
        }

        // Run test when page loads
        window.addEventListener('load', () => {
            testWidgetRegistry();
        });
    </script>
</body>
</html>
