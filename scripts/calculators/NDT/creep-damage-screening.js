module.exports = {
  id: 'creep-damage-screening',
  name: 'Creep damage screening',
  description: 'Heuristic screen for creep cracking patterns in high-temp service',
  category: 'UT',
  module: 'ndt',
  icon: 'FireOutlined',
  tags: ['ut', 'creep', 'screen', 'vision'],
  uiDefinition: [
    { id: 'input-card', type: 'section', title: 'Input Parameters', description: 'Asset, service, inspection data, media, thresholds', icon: 'FormOutlined', order: 1, size: 24 },
    { id: 'asset', type: 'group', title: 'Asset, service, materials', description: 'Component and service conditions', sectionId: 'input-card', order: 1, size: 24 },
    { id: 'component_id', type: 'text', title: 'Component ID', label: 'Component ID', sectionId: 'input-card', groupId: 'asset', size: 6, placeholder: 'e.g., Reheater outlet header' },
    { id: 'material', type: 'text', title: 'Material', label: 'Material', sectionId: 'input-card', groupId: 'asset', size: 6, placeholder: 'e.g., 2.25Cr-1Mo, 9Cr-1Mo' },
    { id: 'product_form', type: 'text', title: 'Product form', label: 'Product form', sectionId: 'input-card', groupId: 'asset', size: 6, placeholder: 'Pipe, header, weld, HAZ, elbow' },
    { id: 'design_temperature_c', type: 'number', title: 'Design temperature (°C)', label: 'Design temperature (°C)', sectionId: 'input-card', groupId: 'asset', size: 6 },
    { id: 'operating_temp_history', type: 'textarea', title: 'Operating temperature history (°C vs time)', label: 'Operating temperature history (°C vs time)', sectionId: 'input-card', groupId: 'asset', size: 12, rows: 3, placeholder: 'Max, average, excursions' },
    { id: 'time_at_temperature_hours', type: 'number', title: 'Time at temperature (hours)', label: 'Time at temperature (hours)', sectionId: 'input-card', groupId: 'asset', size: 6 },
    { id: 'design_pressure_bar', type: 'number', title: 'Design pressure (bar)', label: 'Design pressure (bar)', sectionId: 'input-card', groupId: 'asset', size: 6 },
    { id: 'estimated_stress_mpa', type: 'number', title: 'Estimated hoop/axial stress (MPa)', label: 'Estimated hoop/axial stress (MPa)', sectionId: 'input-card', groupId: 'asset', size: 6 },
    { id: 'inspection', type: 'group', title: 'Inspection data', description: 'Thickness, strain, hardness, replicas', sectionId: 'input-card', order: 2, size: 24, collapsible: true },
    { id: 'ut_thickness_min_mm', type: 'number', title: 'UT thickness min (mm)', label: 'UT thickness min (mm)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'ut_thickness_mean_mm', type: 'number', title: 'UT thickness mean (mm)', label: 'UT thickness mean (mm)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'diametral_strain_pct', type: 'number', title: 'Diametral strain / ovality (%)', label: 'Diametral strain / ovality (%)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'bulge_height_mm', type: 'number', title: 'Bulge height (mm)', label: 'Bulge height (mm)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'surface_hardness_avg_hv', type: 'number', title: 'Surface hardness avg (HV)', label: 'Surface hardness avg (HV)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'surface_hardness_min_hv', type: 'number', title: 'Surface hardness min (HV)', label: 'Surface hardness min (HV)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'replication_cavitation_rating', type: 'number', title: 'Replication cavitation rating (0–5)', label: 'Replication cavitation rating (0–5)', sectionId: 'input-card', groupId: 'inspection', size: 6 },
    { id: 'surface_cracking_observations', type: 'textarea', title: 'Surface cracking observations', label: 'Surface cracking observations', sectionId: 'input-card', groupId: 'inspection', size: 12, rows: 3, placeholder: 'Orientation, length, intergranular look' },
    { id: 'weld_condition', type: 'text', title: 'Weld condition', label: 'Weld condition', sectionId: 'input-card', groupId: 'inspection', size: 12, placeholder: 'Weld metal, HAZ, repairs present' },
    { id: 'media', type: 'group', title: 'Media input (optional)', description: 'Replicas, macro photos, UT/PA C-scan', sectionId: 'input-card', order: 3, size: 24, collapsible: true },
    { id: 'replica_micrographs', type: 'image-upload-with-drawing', title: 'Replica micrographs', label: 'Replica micrographs', sectionId: 'input-card', groupId: 'media', size: 24, props: { accept: 'image/*', multiple: true, clientOnly: true, showThumbnails: true, layout: 'grid' } },
    { id: 'macro_photos', type: 'image-upload-with-drawing', title: 'Macro photos', label: 'Macro photos', sectionId: 'input-card', groupId: 'media', size: 24, props: { accept: 'image/*', multiple: true, clientOnly: true, showThumbnails: true, layout: 'grid' } },
    { id: 'ut_pa_cscan_images', type: 'image-upload-with-drawing', title: 'UT/PA C-scan', label: 'UT/PA C-scan', sectionId: 'input-card', groupId: 'media', size: 24, props: { accept: 'image/*', multiple: true, clientOnly: true, showThumbnails: true, layout: 'grid' } },
    { id: 'thumbnail_size_px', type: 'number', title: 'Thumbnail size (px)', label: 'Thumbnail size (px)', sectionId: 'input-card', groupId: 'media', size: 6 },
    { id: 'annotation_allowed', type: 'switch', title: 'Annotation allowed', label: 'Annotation allowed', sectionId: 'input-card', groupId: 'media', size: 6 },
    { id: 'thresholds', type: 'group', title: 'Thresholds and method settings', description: 'LMP constant and alerts', sectionId: 'input-card', order: 4, size: 24, collapsible: true },
    { id: 'lmp_constant_c', type: 'number', title: 'LMP constant C', label: 'LMP constant C', sectionId: 'input-card', groupId: 'thresholds', size: 6, placeholder: 'Default 20' },
    { id: 'hardness_drop_alert_pct', type: 'number', title: 'Hardness drop alert (%)', label: 'Hardness drop alert (%)', sectionId: 'input-card', groupId: 'thresholds', size: 6 },
    { id: 'diametral_strain_alert_pct', type: 'number', title: 'Diametral strain alert (%)', label: 'Diametral strain alert (%)', sectionId: 'input-card', groupId: 'thresholds', size: 6 },
    { id: 'cavitation_alert_level', type: 'number', title: 'Cavitation alert level (0–5)', label: 'Cavitation alert level (0–5)', sectionId: 'input-card', groupId: 'thresholds', size: 6 },
    { id: 'risk_scoring_weights', type: 'text', title: 'Risk scoring weights', label: 'Risk scoring weights', sectionId: 'input-card', groupId: 'thresholds', size: 12, placeholder: 'e.g., LMP 40%, replica 30%, hardness 20%, strain 10%' },
    { id: 'metadata', type: 'group', title: 'Metadata', description: 'QA traceability', sectionId: 'input-card', order: 5, size: 24, collapsible: true },
    { id: 'operator_id', type: 'text', title: 'Operator ID', label: 'Operator ID', sectionId: 'input-card', groupId: 'metadata', size: 6 },
    { id: 'equipment_id', type: 'text', title: 'Equipment ID', label: 'Equipment ID', sectionId: 'input-card', groupId: 'metadata', size: 6 },
    { id: 'timestamp', type: 'text', title: 'Date/Time', label: 'Date/Time', sectionId: 'input-card', groupId: 'metadata', size: 6 },
    { id: 'location_tag', type: 'text', title: 'Location tag', label: 'Location tag', sectionId: 'input-card', groupId: 'metadata', size: 6 }
  ],
  aiPrompt: [
    'You are an NDT metallurgical analyst.',
    '',
    'Task: Perform a heuristic creep damage screening using service conditions, measurements, and optional images (replicas, macro photos, C-scan). Use images only to support observations. Do not extract numeric values from images.',
    '',
    'Prechecks:',
    '- Validate temperature, time at temperature, hardness data, replica rating. If missing, mark Unknown and continue with available inputs.',
    '- Use Kelvin for LMP. If only °C is given, convert: T_K = T_°C + 273.15.',
    '- If no baseline hardness, skip hardness-drop percent and mark Unknown.',
    '',
    'Definitions:',
    '- LMP = T_K * (C + log10(t_hours)), default C = 20.',
    '- Diametral strain ε_d = 100 * (OD_max - OD_min) / OD_nom, if available.',
    '- Risk score (0–100) = 0.4·LMP_score + 0.3·Replica_score + 0.2·Hardness_score + 0.1·Strain_score. Normalize each sub-score to 0–100 with simple bands: Low, Medium, High.',
    '- Screening categories: Pass, Monitor, Suspect.',
    '',
    'Output ONLY:',
    '',
    '# Creep Damage Screening',
    '',
    '## Input Summary',
    '- Component: <id>, Material: <material>, Location: <tag>',
    '- Design temp (°C): <value>, Operating temp max/avg (°C): <values>, Time at temp (h): <value>',
    '- Estimated stress (MPa): <value or Unknown>, Design pressure (bar): <value or Unknown>',
    '- Hardness (HV): baseline <value or Unknown>, measured <value or map summary>',
    '- Diametral strain (%): <value or Unknown>, Bulge height (mm): <value or Unknown>',
    '- Replica cavitation rating (0–5): <value or Unknown>',
    '- Media: <types and counts or "None">',
    '',
    '## Key Outputs',
    '| Key outputs | Value |',
    '| --- | --- |',
    '| LMP (current conditions) | <value or Unknown> |',
    '| Hardness drop (%) | <value or Unknown> |',
    '| Diametral strain (%) | <value or Unknown> |',
    '| Replica indication | <rating and short note> |',
    '| Suspect zones | <locations or None> |',
    '| Risk score (0–100) | <value with band: Low/Med/High> |',
    '| Overall screen | <Pass/Monitor/Suspect> |',
    '',
    '## Calculations',
    '- LMP formula and substitution.',
    '- Hardness drop calculation (if baseline provided).',
    '- Diametral strain calculation (if OD data provided).',
    '- Brief rationale for sub-scores and how images support findings.',
    '',
    '## Rationale and Recommendations',
    'One or two sentences on likely condition and next steps (e.g., "Replica shows GB cavities Level 3 at weld toe. Recommend detailed metallurgical exam and local FFS per API 579 Part 10; reduce interval.").',
    '',
    'END OF REPORT'
  ].join('\n')
};


