module.exports = {
  id: 'scaff-stability-estimator',
  name: 'Scaffold Stability Estimator',
  description: 'Predicts probability of scaffold tipping based on key parameters',
  category: 'Structural Integrity',
  module: 'scaffolding',
  icon: 'LineChartOutlined',
  tags: ['stability', 'tipping', 'estimator', 'scaffolding'],
  uiDefinition: [
    { id: 'input-card', type: 'section', title: 'Inputs', description: 'Provide scaffold and environment parameters', icon: 'FormOutlined', order: 1, size: 24 },
    { id: 'geometry', type: 'group', title: 'Scaffold Geometry', description: 'Dimensions and configuration', sectionId: 'input-card', order: 1, size: 24 },
    { id: 'height_m', type: 'number', title: 'Height (m)', label: 'Height (m)', sectionId: 'input-card', groupId: 'geometry', size: 6, required: true },
    { id: 'base_width_m', type: 'number', title: 'Base width (m)', label: 'Base width (m)', sectionId: 'input-card', groupId: 'geometry', size: 6, required: true },
    { id: 'base_length_m', type: 'number', title: 'Base length (m)', label: 'Base length (m)', sectionId: 'input-card', groupId: 'geometry', size: 6 },
    { id: 'platform_levels', type: 'number', title: 'Platform levels', label: 'Number of platform levels', sectionId: 'input-card', groupId: 'geometry', size: 6, defaultValue: 1 },
    { id: 'loading', type: 'group', title: 'Loading Conditions', description: 'Applied loads', sectionId: 'input-card', order: 2, size: 24 },
    { id: 'live_load_kg', type: 'number', title: 'Live load (kg)', label: 'Total live load (kg)', sectionId: 'input-card', groupId: 'loading', size: 6 },
    { id: 'dead_load_kg', type: 'number', title: 'Dead load (kg)', label: 'Scaffold self-weight (kg)', sectionId: 'input-card', groupId: 'loading', size: 6 },
    { id: 'eccentricity_m', type: 'number', title: 'Load eccentricity (m)', label: 'Load eccentricity (m)', sectionId: 'input-card', groupId: 'loading', size: 6, defaultValue: 0 },
    { id: 'impact_factor', type: 'number', title: 'Impact factor', label: 'Dynamic impact factor', sectionId: 'input-card', groupId: 'loading', size: 6, defaultValue: 1.2 },
    { id: 'environment', type: 'group', title: 'Environmental Factors', description: 'Wind and exposure', sectionId: 'input-card', order: 3, size: 24 },
    { id: 'wind_speed_mps', type: 'number', title: 'Wind speed (m/s)', label: 'Design wind speed (m/s)', sectionId: 'input-card', groupId: 'environment', size: 6 },
    { id: 'wind_direction', type: 'select', title: 'Wind direction', label: 'Critical wind direction', sectionId: 'input-card', groupId: 'environment', size: 6, options: [
      { label: 'Perpendicular to face', value: 'perpendicular' },
      { label: 'Diagonal (45°)', value: 'diagonal' },
      { label: 'Parallel to face', value: 'parallel' }
    ], defaultValue: 'perpendicular' },
    { id: 'sheeting_percent', type: 'number', title: 'Sheeting (%)', label: 'Sheeting/cladding (%)', sectionId: 'input-card', groupId: 'environment', size: 6, defaultValue: 0 },
    { id: 'ground_condition', type: 'select', title: 'Ground condition', label: 'Ground condition', sectionId: 'input-card', groupId: 'environment', size: 6, options: [
      { label: 'Concrete/solid', value: 'solid' },
      { label: 'Compacted gravel', value: 'gravel' },
      { label: 'Soft soil', value: 'soft' },
      { label: 'Sloped/uneven', value: 'sloped' }
    ] },
    { id: 'stabilization', type: 'group', title: 'Stabilization Measures', description: 'Ties and bracing', sectionId: 'input-card', order: 4, size: 24 },
    { id: 'tie_spacing_vertical_m', type: 'number', title: 'Vertical tie spacing (m)', label: 'Vertical tie spacing (m)', sectionId: 'input-card', groupId: 'stabilization', size: 6 },
    { id: 'tie_spacing_horizontal_m', type: 'number', title: 'Horizontal tie spacing (m)', label: 'Horizontal tie spacing (m)', sectionId: 'input-card', groupId: 'stabilization', size: 6 },
    { id: 'tie_capacity_kn', type: 'number', title: 'Tie capacity (kN)', label: 'Individual tie capacity (kN)', sectionId: 'input-card', groupId: 'stabilization', size: 6, defaultValue: 6.0 },
    { id: 'outriggers_used', type: 'switch', title: 'Outriggers used', label: 'Outriggers/stabilizers used', sectionId: 'input-card', groupId: 'stabilization', size: 6, defaultValue: false },
    { id: 'ballast_weight_kg', type: 'number', title: 'Ballast weight (kg)', label: 'Ballast/kentledge (kg)', sectionId: 'input-card', groupId: 'stabilization', size: 6, defaultValue: 0 },
    { id: 'bracing_pattern', type: 'select', title: 'Bracing pattern', label: 'Bracing pattern', sectionId: 'input-card', groupId: 'stabilization', size: 6, options: [
      { label: 'None', value: 'none' },
      { label: 'Plan bracing only', value: 'plan' },
      { label: 'Facade bracing only', value: 'facade' },
      { label: 'Full bracing', value: 'full' }
    ] }
  ],
  aiPrompt: [
    'You are a scaffold stability analysis specialist.',
    '',
    'Calculate scaffold stability factor and tipping probability based on comprehensive geometric, loading, and environmental inputs.',
    '',
    'Use:',
    '- Overturning moment: M_o = Wind force × H/2 + Live load × eccentricity',
    '- Resisting moment: M_r = (Dead load + Ballast) × Base width/2',
    '- Stability factor: SF = M_r / M_o (must be > 1.5)',
    '- H/B ratio check: Height/Base width (critical if > 3:1)',
    '- Wind force: F = 0.613 × V² × Area × Shape factor × (1 + sheeting%/100)',
    '- Tie contribution: Each tie resists moment = Tie capacity × spacing',
    '- Ground factor: Solid=1.0, Gravel=0.9, Soft=0.7, Sloped=0.6',
    '- Outrigger benefit: Increases effective base by 40-60%',
    '- Bracing effectiveness: None=0.5, Plan=0.7, Facade=0.8, Full=1.0',
    '- Stability % = min(100, (SF/2.0) × 100) × ground factor × bracing factor',
    '',
    'Guidelines:',
    '- Calculate overturning and resisting moments',
    '- Apply all stability factors and corrections',
    '- Determine critical failure mode',
    '- Provide confidence-based stability percentage',
    '',
    'Output ONLY:',
    '# Scaffold Stability Estimator',
    '## Report Summary',
    'One sentence summarizing H/B ratio, stability factor, and overall stability assessment.',
    '## Key outputs',
    '| Key outputs | Value |',
    '| --- | --- |',
    '| Stability percentage | <value>% |',
    '| Stability factor (SF) | <value> |',
    '| H/B ratio | <value>:1 |',
    '| Overturning moment (kN.m) | <value> |',
    '| Resisting moment (kN.m) | <value> |',
    '| Wind force (kN) | <value> |',
    '| Critical failure mode | <overturning/sliding/bearing> |',
    '| Ground bearing pressure (kPa) | <value> |',
    '## Recommendations',
    '1. Primary stabilization measure needed',
    '2. Critical tie/bracing locations',
    '3. Load redistribution strategy',
    '## Alternatives & Trade-offs',
    '| Stabilization Option | New SF | Cost Impact | Implementation |',
    '| --- | --- | --- | --- |',
    '| Current configuration | <value> | Baseline | - |',
    '| Add outriggers | <value> | Low | Quick |',
    '| Increase tie frequency | <value> | Medium | Moderate |',
    '| Add ballast (500kg) | <value> | Low | Quick |',
    '| Widen base by 0.5m | <value> | High | Complex |',
    '## Calculations',
    '- Wind force: 0.613 × <V>² × <A> × <factors> = <value> kN',
    '- Overturning moment: <wind> × <H/2> + <eccentric> = <value> kN.m',
    '- Resisting moment: <weights> × <B/2> = <value> kN.m',
    '- Stability factor: <M_r> / <M_o> = <value>',
    '## Assumptions & Uncertainty',
    '- Wind gust factor: 1.5 applied',
    '- Connection rigidity: 80% assumed',
    '- Load distribution: Uniform assumed',
    '- Confidence level: <value>%',
    '- Sensitivity to wind: ±<value>% per 5 m/s',
    '## Escalation Criteria',
    '- If SF < 1.5: Immediate stabilization required',
    '- If H/B > 4:1: Engineering review mandatory',
    '- If stability < 70%: Work stoppage recommended',
    '- If ground pressure > allowable: Foundation upgrade needed',
    '## Rationale',
    'Detailed explanation of stability assessment and critical factors.',
    '## References and Standards',
    '- EN 12811-1:2003 Stability requirements',
    '- OSHA 1926.451(c) Stability criteria',
    '- BS 5975:2019 Section 20 - Stability of scaffolds',
    '',
    'END OF REPORT'
  ].join('\n')
};


